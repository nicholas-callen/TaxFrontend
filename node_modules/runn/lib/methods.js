'use strict';

var methods = ['before', 'middle', 'after'],
	utils = require('./utils.js');

module.exports = function(ctx) {
	var exps = {};

	/**
	 *	Iterate over the methods and call attachMiddleware
	 */
	methods.forEach(attachMiddleware.bind(ctx));

	/**
	 *	Add a method to exports that allows users to attach middlware
	 */
	function attachMiddleware (name) {
		var me = this;

		me[name] = function() {
			var t = name+'stack';
			if (!me[t]) me[t] = [];
			me[t] = me[t].concat(utils.flaten(arguments));
		};
	};
};
